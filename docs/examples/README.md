# Glot CLI Examples

Real-world examples and usage patterns for the glot CLI.

## Basic Workflows

### Creating and Setting Up a New Project

```bash
# Create a new Rust CLI project
glot new rust my-cli-tool
cd my-cli-tool
direnv allow

# First build (downloads dependencies)
glot build

# Run the hello world
glot run

# Check everything works
glot check
```

### Daily Development Workflow

```bash
# Start working
cd my-project
# direnv automatically loads environment

# Edit code with your favorite editor
code src/main.rs  # or vim, emacs, etc.

# Format and check code
glot fmt
glot lint

# Test changes
glot test

# Build and run
glot build
glot run -- --help

# Before committing
glot check  # Runs fmt + lint + test + build
git add -A
git commit -m "Add new feature"
```

## Language-Specific Examples

### Rust Development

```bash
# Create Rust project
glot new rust tcp-server
cd tcp-server
direnv allow

# Development cycle
glot fmt                    # rustfmt + nixpkgs-fmt
glot lint                   # cargo clippy with warnings as errors
glot test                   # cargo test
glot build --release        # optimized build
glot run -- --port 8080     # run with arguments
```

### Python Development

```bash
# Create Python project
glot new python data-processor
cd data-processor
direnv allow

# Development cycle
glot fmt                    # black + ruff format
glot lint                   # ruff check + mypy
glot test                   # pytest
glot build                  # poetry build
glot run -- input.csv      # run with file argument
```

### C# Development

```bash
# Create C# project
glot new csharp web-api
cd web-api
direnv allow

# Development cycle
glot fmt                    # dotnet format
glot lint                   # compiler warnings + analyzers
glot test                   # dotnet test
glot build --release        # optimized build
glot run                    # dotnet run
```

## CI/CD Integration

### GitHub Actions

```yaml
# .github/workflows/ci.yml
name: CI
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Nix
        uses: cachix/install-nix-action@v22
        with:
          github_access_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Check code quality
        run: |
          nix develop --command glot fmt --check
          nix develop --command glot lint
          nix develop --command glot test
          nix develop --command glot build --release
```

### GitLab CI

```yaml
# .gitlab-ci.yml
stages:
  - test
  - build

variables:
  NIX_CONFIG: "experimental-features = nix-command flakes"

test:
  stage: test
  image: nixos/nix:latest
  script:
    - nix develop --command glot check

build:
  stage: build
  image: nixos/nix:latest
  script:
    - nix develop --command glot build --release
  artifacts:
    paths:
      - result/
```

### Docker Integration

```dockerfile
# Dockerfile
FROM nixos/nix:latest

WORKDIR /app
COPY . .

# Enable flakes and build
RUN echo "experimental-features = nix-command flakes" >> /etc/nix/nix.conf
RUN nix develop --command glot build --release

# Runtime
CMD ["nix", "develop", "--command", "glot", "run", "--release"]
```

## IDE Integration

### VS Code Configuration

```json
// .vscode/settings.json
{
  "nix.enableLanguageServer": true,
  "nix.serverPath": "nil",
  "rust-analyzer.server.path": "rust-analyzer",
  "python.pythonPath": "python",
  "omnisharp.path": "omnisharp",
  "terminal.integrated.defaultProfile.linux": "nix-shell"
}
```

### Direnv Integration

```bash
# .envrc (already provided by templates)
#!/usr/bin/env bash
use flake

# Smart caching logic for glot CLI
# ... (full .envrc content as generated by templates)
```

## Advanced Usage Patterns

### Multi-Project Repository

```bash
# Repository structure
monorepo/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/          # Rust service
â”‚   â””â”€â”€ processor/    # Python service
â”œâ”€â”€ libs/
â”‚   â””â”€â”€ shared/       # C# library
â””â”€â”€ scripts/

# Working with subprojects
cd services/api
glot build --release

cd ../processor
glot test

cd ../../libs/shared
glot check
```

### Custom Build Scripts

```bash
# Add to flake.nix apps for custom workflows
{
  apps = {
    deploy = {
      type = "app";
      program = "${pkgs.writeShellScript "deploy" ''
        set -e
        glot build --release
        docker build -t myapp .
        docker push myapp:latest
      ''}";
    };
  };
}

# Use with nix run
nix run .#deploy
```

### Development Environment Customization

```nix
# In flake.nix - customize development shell
devShells.default = pkgs.mkShell {
  packages = with pkgs; [
    # Standard tools from nix-polyglot
    rustc cargo clippy rustfmt

    # Add project-specific tools
    postgresql
    redis
    docker-compose
  ];

  shellHook = ''
    echo "ðŸš€ Development environment ready!"
    echo "Available commands: glot build, glot run, glot test"
  '';
};
```

## Performance Optimization

### Build Optimization

```bash
# Parallel builds (if supported by language)
export MAKEFLAGS="-j$(nproc)"

# Release builds for production
glot build --release

# Clean cache periodically
glot clean
```

### Caching Strategies

```bash
# Pin dependencies for consistent builds
git add flake.lock
git commit -m "Pin dependencies"

# Use binary cache for team
# Add to /etc/nix/nix.conf:
# substituters = https://cache.nixos.org https://your-cache.example.com
# trusted-public-keys = cache.nixos.org-1:... your-key:...
```

## Troubleshooting Examples

### Debug Build Issues

```bash
# Verbose build output
nix build --print-build-logs .#dev

# Manual build to see errors
nix develop --command bash
cargo build --verbose  # or equivalent for your language
```

### Debug Template Creation

```bash
# Test template locally
nix run .#new-rust debug-test

# Use GitHub version as fallback
nix run github:ritzau/nix-polyglot#new-rust debug-test

# Check available templates
glot new
```

### Environment Issues

```bash
# Verify nix development environment
nix develop --command env | grep -E "(PATH|LANG)"

# Check direnv is working
direnv status

# Reload environment
direnv reload
```

### Performance Issues

```bash
# Check what's taking time
time glot build

# Check nix store usage
du -sh /nix/store

# Clean up old builds
nix-collect-garbage -d
```

## Integration Examples

### With Make/Just (Migration)

```makefile
# Makefile - migrate to use glot
.PHONY: build test fmt lint clean

build:
	glot build

test:
	glot test

fmt:
	glot fmt

lint:
	glot lint

clean:
	glot clean

release:
	glot build --release
```

### With Package Managers

```bash
# Don't fight the package manager, use both
# Use glot for development, package manager for distribution

# Rust
glot build --release
cargo publish

# Python
glot build
poetry publish

# C#
glot build --release
dotnet pack
dotnet nuget push
```

### With Git Hooks

```bash
# Pre-commit hook (automatically installed by .envrc)
#!/bin/bash
# .git/hooks/pre-commit
set -e

echo "Running pre-commit checks..."
glot fmt --check || {
    echo "Code formatting required. Run: glot fmt"
    exit 1
}

glot lint || {
    echo "Linting failed. Fix issues and try again."
    exit 1
}

echo "Pre-commit checks passed!"
```

## Tips and Best Practices

### Development Flow

1. **Always use `direnv allow`** after cloning
2. **Run `glot fmt`** before committing
3. **Use `glot check`** before pushing
4. **Keep `flake.lock` committed** for reproducibility
5. **Use `--release` for benchmarking** and production

### Team Workflows

1. **Pin nix-polyglot version** in production projects
2. **Document custom commands** in project README
3. **Share binary cache** for faster builds
4. **Use consistent tools** across team members

### Performance Tips

1. **Enable binary cache** for your organization
2. **Use `glot clean`** to free disk space
3. **Pin dependencies** with `flake.lock`
4. **Profile builds** to identify bottlenecks

---

These examples cover common usage patterns. For more specific scenarios, see the [User Guide](../USER_GUIDE.md) and [FAQ](../FAQ.md).
